---
import Layout from '../../layouts/Layout.astro';
import apolloClientPkg from '@apollo/client';
import client from '../../api/graphqlClient';
const { gql } = apolloClientPkg;

// Zapytanie GraphQL z filtrem kategorii
const GET_IMAGES_BY_CATEGORY = gql`
  query GetImagesByCategory($where: RootQueryToGaleriaObrazowConnectionWhereArgs) {
    allGaleriaObrazow(where: $where) {
      nodes {
        id
        title
        slug
        galeriaGrupa {
          tytul
          opis
          dostepnosc
          kategoria
          obraz {
            node {
              sourceUrl
              altText
            }
          }
        }
      }
    }
  }
`;

// Generuj ścieżki statyczne dla obrazów w kategorii "Art"
export async function getStaticPaths() {
    const { data } = await client.query({
        query: GET_IMAGES_BY_CATEGORY,
        variables: { where: { kategoria: ["Art"] } },
    });

    const artImages = data.allGaleriaObrazow.nodes;

    return artImages.map((image) => ({
        params: { slug: image.slug },
        props: { image },
    }));
}

// Pobierz dane dla dynamicznego slug
const { image } = Astro.props;
---

<Layout title={image.galeriaGrupa.tytul}>
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row items-start lg:gap-8 bg-background rounded-lg shadow-lg p-6">
            <!-- Obraz -->
            <div class="flex-shrink-0 w-full lg:w-1/2 bg-primary rounded-lg overflow-hidden">
                <img
                        src={image.galeriaGrupa.obraz.node.sourceUrl}
                        alt={image.galeriaGrupa.tytul}
                        class="w-full h-auto transition-transform duration-300 hover:scale-105"
                />
            </div>

            <!-- Opis -->
            <div class="flex-1 mt-8 lg:mt-0">
                <!-- Tytuł -->
                <h1 class="text-4xl font-bold mb-6 text-dark">{image.galeriaGrupa.tytul}</h1>

                <!-- Opis -->
                <p class="text-lg text-text mb-6 leading-relaxed">
                    {image.galeriaGrupa.opis}
                </p>

                <!-- Status -->
                <div class="flex items-center gap-4">
                    <span class="text-lg font-medium text-text">Status:</span>
                    <span
                            class={`px-4 py-2 rounded-full font-semibold text-sm ${
                                image.galeriaGrupa.dostepnosc
                                    ? "bg-green-100 text-green-800"
                                    : "bg-red-100 text-red-800"
                            }`}
                    >
            {image.galeriaGrupa.dostepnosc ? "Dostępny" : "Niedostępny"}
          </span>
                </div>
            </div>
        </div>
    </div>
</Layout>
